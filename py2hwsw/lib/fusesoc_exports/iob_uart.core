CAPI=2:

name: iobundle:py2hwsw:iob_uart:0.81
#license: MIT
description : The IObundle UART is a RISC-V-based Peripheral written in Verilog, which users can download for free, modify, simulate and implement in FPGA or ASIC. It is written in Verilog and includes a C software driver. The IObundle UART is a very compact IP that works at high clock rates if needed. It supports full-duplex operation and a configurable baud rate. The IObundle UART has a fixed configuration for the Start and Stop bits. More flexible licensable commercial versions are available upon request.

filesets:
  rtl:
    files:
      - iob_uart/hardware/src/iob_uart_csrs.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reg_ca_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reg_ca.v
      - iob_uart/hardware/src/iob_reg_cae_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reg_cae.v
      - iob_uart/hardware/src/iob_reverse_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reverse.v
      - iob_uart/hardware/src/iob_prio_enc_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_prio_enc.v
      - iob_uart/hardware/src/iob_ctls_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_ctls.v
      - iob_uart/hardware/src/iob_universal_converter_iob_iob_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_universal_converter_iob_iob.v
      - iob_uart/hardware/src/iob_uart_csrs_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_uart_csrs.v
      - iob_uart/hardware/src/iob_reg_a_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reg_a.v
      - iob_uart/hardware/src/iob_sync_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_sync.v
      - iob_uart/hardware/src/iob_reg_care_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_reg_care.v
      - iob_uart/hardware/src/iob_uart_core_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_uart_core.v
      - iob_uart/hardware/src/iob_coverage_analyze_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_uart_conf.vh: {is_include_file : true}
      - iob_uart/hardware/src/iob_uart.v
    file_type : verilogSource
  sim:
    files:
      - iob_uart/hardware/simulation/src/iob_uut_conf.vh: {is_include_file : true}
      - iob_uart/hardware/simulation/src/iob_uut.v
      - iob_uart/hardware/simulation/src/iob_v_tb.v
      - iob_uart/hardware/simulation/src/iob_v_tb.vh: {is_include_file : true}
    file_type : verilogSource
  scripts:
    files:
      - iob_uart/scripts/iob_cov_analyze.py
      - iob_uart/scripts/iob_colors.py
      - iob_uart/scripts/board_client.py
      - iob_uart/scripts/console.py
      - iob_uart/scripts/console_ethernet.py
      - iob_uart/scripts/makehex.py
      - iob_uart/scripts/hex_join.py
  sw:
    files:
      - iob_uart/config_build.mk
      - iob_uart/software/Makefile
      - iob_uart/software/sw_build.mk
      - iob_uart/software/src/iob_c_tb.c
      - iob_uart/software/src/iob_vlt_tb.cpp
      - iob_uart/software/src/iob_uart.c
      - iob_uart/software/src/iob_uart.h
      - iob_uart/software/src/iob_uart_csrs_pc_emul.c
      - iob_uart/software/src/iob_core_tb.c
      - iob_uart/software/src/iob_uart_csrs.h
      - iob_uart/software/src/iob_uart_csrs.c
      - iob_uart/software/src/hw_driver.c
      - iob_uart/software/src/iob_reverse_conf.h
      - iob_uart/software/src/iob_prio_enc_conf.h
      - iob_uart/software/src/iob_ctls_conf.h
      - iob_uart/software/src/iob_universal_converter_iob_iob_conf.h
      - iob_uart/software/src/iob_uart_csrs_conf.h
      - iob_uart/software/src/iob_uart_core_conf.h
      - iob_uart/software/src/iob_coverage_analyze_conf.h
      - iob_uart/software/src/iob_uart_conf.h
      - iob_uart/software/src/iob_reg_ca_conf.h
      - iob_uart/software/src/iob_reg_cae_conf.h
      - iob_uart/software/src/iob_reg_a_conf.h
      - iob_uart/software/src/iob_sync_conf.h
      - iob_uart/software/src/iob_reg_care_conf.h
      - iob_uart/software/simulation/src/iob_universal_converter_iob_iob_conf.h
      - iob_uart/software/simulation/src/iob_uut_conf.h
      - iob_uart/software/zynq_ps/Makefile
      - iob_uart/software/zynq_ps/lscript.ld
      - iob_uart/software/zynq_ps/prog.tcl
      - iob_uart/software/zynq_ps/sw_build.tcl
      - iob_uart/software/zynq_ps/src/main.c


targets:
  default:
    filesets:
      - rtl
  sim:
    toplevel: iob_v_tb
    description: Simulate the design, using board_client.py to manage simulation processes and timeout.
    # Generic flow only runs the build step by default.
    flow: generic
    flow_options:
      tool: icarus
    filesets:
      - rtl
      - sim
    hooks:
      post_build:
        - sw_build
        - board_client

scripts:
  sw_build:
    cmd:
      - make
      - -C
      - src/iobundle_py2hwsw_iob_uart_0.81/iob_uart/software
      - build
      #- USE_FPGA=$(USE_FPGA)
    filesets:
      - sw

  board_client:
    cmd:
      # Maybe there is a way to import variables from sim_build.mk (like GRAB_TIMEOUT)?
      - src/iobundle_py2hwsw_iob_uart_0.81/iob_uart/scripts/board_client.py
      - grab 
      - "300"
      - -s
      #run the C testbench in background and kill it when simulator exits
      - src/iobundle_py2hwsw_iob_uart_0.81/iob_uart/software/tb & make run && (kill $$! >/dev/null 2>&1; true) || (kill $$! >/dev/null 2>&1; false)
    filesets:
      - scripts
